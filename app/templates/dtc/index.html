{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}UAV_HiRAP{% endblock %}

{% block head %}
{{ super() }}
<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="{{ url_for('static', filename='uploadbar.js') }}"> </script>
{% endblock%}

{% block page_content %}
<div class="page-header">
    <h1>
    Welcome to use the Decision Tree Classifier! You could:
    </h1>
</div>
<div>
	<h2>Add a new project:</h2>
    <form class="form" method="post" enctype="multipart/form-data">
    <table width="100%" border="0">
      <tr>
        <td colspan="3">
        {{ form.hidden_tag() }}
        {{ wtf.form_field(form.project_name) }}</td>
      </tr>
      <tr>
        <td width="33%" rowspan="2" align="center">
        {{ wtf.form_field(form.origin_pic_dir) }}        </td>
        <td width="33%" align="center">{{ wtf.form_field(form.fore_trainingdata_dir) }} </td>
        <td width="33%" align="center">{{ wtf.form_field(form.back_trainingdata_dir) }} </td>
      </tr>
      <tr>
        <td colspan="2" align="center"><font color="red">Note: if training pictures do not have an alpha layer, the black/white background will be counted as training data</font></td>
      </tr>
      <tr>
        <td colspan="3" align="center"><hr /></td>
      </tr>
      <tr>
		<td align="center">
    		<font color="gray">Example:[Otindag Sandy land.tif]</font>
    		<p><img src="{{ url_for('static', filename="ExamplePictures/preview-Classify.jpg") }}" width="80%"/></p>
    	</td>
    	<td align="center">
    		<font color="gray">Example:[Tree training picture.png]</font>
    		<p><img src="{{ url_for('static', filename="ExamplePictures/preview-Tree.png") }}" width="80%"/></p>
    	</td>
    	<td align="center">
    		<font color="gray">Example:[Sand training picture.png]</font>
    		<p><img src="{{ url_for('static', filename="ExamplePictures/preview-Sand.png") }}" width="80%"/></p></td>
  		</tr>
      </tr>
    </table>
    {{ wtf.form_field(form.comments) }}
    {{ wtf.form_field(form.submit) }}
    </form>
</div>
<hr />
<div class="progress">
    <div id="progressBar", class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em; width: 2%;">
    	0%
    </div>
</div>
<script>
$(document).ready(function(){
	
	$('form').on('submit', function(event) {
			
		event.preventDefault();
			
		var formData = new FormData(this);
			
		$.ajax({
			xhr: function(){
				var xhr = new XMLHttpRequest();
				
				xhr.upload.addEventListener('progress', function(e) {
					
					if (e.lengthComputable) {
						
						console.log('Bytes loaded: ' + e.loaded);
						console.log('total Size:' + e.total);
						console.log('Percentage Uploaded: ' + (e.loaded / e.total))
						
						var percent = Math.round((e.loaded / e.total) * 100);
						
						$('#progressBar').attr('aria-valuenow', percent).css('width', percent + '%').text(percent + '%')
					
					}
				
				});
				
				return xhr;
			},
			type: 'POST',
			data: formData,
			cache: false,
			processData:false,
			contentType:false,
			success: function() {
				
				setTimeout(function(){
					location.reload("{{ url_for('dtc.inproject', username=current_user.username, project_id=DTC_Project.query.order_by(DTC_Project.id.desc()).first().id+1 ) }}");
				}, 1000);

			},
			error: function() {
				
				location.reload("{{ url_for('dtc.decision_tree_submit', username=current_user.username) }}");
				
			}	
		
		});
		
	});
	
});
</script>
<div>
	<h2>Or view/edit your former projects:</h2>
</div>
<!-- Use style.css, the example template is for "Post" database. But in this project, we replace "Post" to "DTC_Project", so it is the reason why the following codes' class== post* -->
<ul class="posts">
	{% for dtc_project in dtc_projects %}
    <li class="post">
    	<div class="profile-thumbnail">
				<img class="img-rounded profile-thumbnail" src="{{ url_for('static', filename='UserData/DTC/'+current_user.email+'/'+dtc_project.id|string+dtc_project.icon|string) }} ">
		</div>
        <div class="post-content">
        	<div class="post-date">{{ moment(dtc_project.timestamp).fromNow() }}</div>
        	<div class="post-author">
        		<a href="{{ url_for('dtc.inproject', username=current_user.username, project_id=dtc_project.id)}}">
            		{{ dtc_project.project_name }}
            	</a>
        	</div>
        	<div class="post-body">
            	{{ dtc_project.comments }}
            </div>
            <div class="post-foot">
				<a href="{{ url_for('dtc.edit', username=current_user.username, project_id=dtc_project.id) }}">
					<span class="label label-primary">Edit</span>
				</a>
                <a href="javascript:if(confirm('Are you sure to delete this object?'))location='{{ url_for('dtc.delete', username=current_user.username, project_id=dtc_project.id) }}'">
                    <span class="label label-default">Delete</span>
                </a>
            </div>
        </div>
    </li>
    {% endfor %}
</ul>
{% endblock %}

